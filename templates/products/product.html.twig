{% extends 'base3-category.html.twig' %}

    {% block stylesheets %}
        {{ parent() }}
        {{ encore_entry_link_tags('product') }}
    {% endblock %}
{% block body %}
    <div id="dark"></div>
    <div class="container">

        <ul class="breadcrumb">
            <li><a href="{{ path('catalog') }}"><i class="fas fa-home"></i></a></li>
            {% for category in product.categories %}
                <li><a href="{{ path('category', {name: category.title, id: category.id}) }}">{{ category.title }}</a></li>
            {% endfor %}
            <li class="last">{{ product.name }}</li>
        </ul>

        {% for message in app.flashes('success') %}
            <div class="alert alert-success">
                {{ message }}
            </div>
        {% endfor %}
        <div class="productCard">
            <div class="product-gallery">
                <div class="gallery">
                    <a class="item popup-link" href="#image">
                        <img src="{{ asset(product.mainImage| product_image_path) }}" alt="Первый слайд">
                    </a>
                    {% for main_gallery in product.images %}
                        <a class="item popup-link" href="#image">
                            <img src="{{ asset(main_gallery.imageName| product_image_path) }}">
                        </a>
                    {% endfor %}
                    <a class="prev">&#10094;</a>
                    <a class="next">&#10095;</a>

                    {% if app.session.has('wish') %}
                        {% if product.id in app.session.get('wish').items|keys %}
                            {% set btn_wish = 'active js-wish' %}
                        {% else %}
                            {% set btn_wish = 'js-wish-product' %}
                        {% endif %}
                    {% else %}
                        {% set btn_wish = 'js-wish-product' %}
                    {% endif %}

                    {% if app.session.has('compare') %}
                        {% if product.id in app.session.get('compare').items|keys %}
                            {% set btn_comp = 'active js-comp' %}
                        {% else %}
                            {% set btn_comp = 'js-compare-product' %}
                        {% endif %}
                    {% else %}
                        {% set btn_comp = 'js-compare-product' %}
                    {% endif %}
                    <button class="btn-icon-wish {{ btn_wish }}" onclick="window.wishProduct(event)"
                            data-url="{{ path('wish_add', {id: product.id}) }}"><i class="fas fa-heart"></i></button>
                    <button class="btn-icon-comp {{ btn_comp }}" onclick="window.compareProduct(event)"
                            data-url="{{ path('compare_add', {id: product.id}) }}"><i class="fas fa-balance-scale"></i></button>
                </div>

                <div class="gallery-subs">
                    <div class="gallery-sub_item" data-pos="1">
                        <img class="gallery-sub_img"
                             src="{{ asset(product.mainImage| assets_image_path  | imagine_filter('cart_univers2')) }}">
                    </div>
                    {% if product.images|length > 0 %}

                        {% for sub_gallery in product.images %}
                            <div class="gallery-sub_item" data-pos="{{ loop.index +1 }}">
                                <img class="gallery-sub_img"
                                     src="{{ asset(sub_gallery.imageName| assets_image_path  | imagine_filter('cart_univers2')) }}">
                            </div>
                        {% endfor %}

                    {% endif %}
                </div>
            </div>


            <div class="product-features">
                <div class="head-name">
                    <h1 class="product-name">{{ product.name }}</h1>
                </div>
                <ul class="general-info">
                    <li class="code">
                        <strong class="key">Код:</strong>
                        <span class="value">{{ product.id }}</span>
                    </li>
                </ul>

                <div class="rating-section">
                    <div class="rating">
                        {% if ratingProduct == 0 %}
                            {% for i in 1..5 %}
                                <i style="color: #ffa900" class="far fa-star"></i>
                            {% endfor %}
                        {% elseif ratingProduct is null %}
                            {% set i = 1 %}
                            {% for i in 1..ratingProduct %}
                                <i style="color: #ffa900" class="fas fa-star"></i>
                            {% endfor %}
                        {% elseif ratingProduct == 5 %}
                            {% set i = 1 %}
                            {% for i in 1..ratingProduct %}
                                <i style="color: #ffa900" class="fas fa-star"></i>
                            {% endfor %}
                        {% elseif ratingProduct is not null%}
                            {% set i = 1 %}
                            {% for i in 1..ratingProduct %}
                                <i style="color: #ffa900" class="fas fa-star"></i>
                            {% endfor %}
                            {% set i = 1 %}
                            {% for i in ratingProduct..4 %}
                                <i style="color: #ffa900" class="far fa-star"></i>
                            {% endfor %}
                        {% endif %}
                        {% if commentProduct.comments is   empty %}
                        {% else %}
                        {% for category in product.categories %}
                            <span class="review-link">
                            <a href="{{ path('comments', {name: category.title, link: product.link, id: product.id }) }}">Відгуки покупців </a>
						</span>
                        {% endfor %}
                        {% endif %}
                    </div>
                </div>

                <div class="cart-section">

                    <!-- Add to cart form -->
                    <div class="price-section">
                        {% if product.discount is not empty %}
                            <s class="price-old">{{ product.unitPrice }} ₴</s>
                            <span class="price-discount">{{ (product.unitPrice * (100 - product.discount)/100)|round(0, 'floor') }} ₴</span>
                        {% else %}
                            <span class="price">{{ product.unitPrice }} ₴</span>
                        {% endif %}
                    </div>

                    <div class="sub-btn">
                        <button class="btn-icon-wish2 active js-wish" onclick="window.wishProduct(event)"
                                data-url="{{ path('wish_add', {id: product.id}) }}"><i class="fas fa-heart"></i></button>
                        <button class="btn-icon-comp2 {{ btn_comp }}" onclick="window.compareProduct(event)"
                                data-url="{{ path('compare_add', {id: product.id}) }}"><i class="fas fa-balance-scale"></i></button>
                    </div>

                    {% if app.session.has('cart') %}
                        {% if product.id in app.session.get('cart').products|keys %}
                            {% set btn_cart = 'active js-cart' %}
                        {% else %}
                            {% set btn_cart = 'js-add-product' %}
                        {% endif %}
                    {% else %}
                        {% set btn_cart = 'js-add-product' %}
                    {% endif %}
                    <!---   BTN-CART   --->
                    <button type="button" id="button-cart" class="buy-btn {{ btn_cart }}" onclick="window.addProduct(event)"
                            data-url="{{ path('cart_add', {id: product.id}) }}">
                        <i class="fas fa-shopping-cart"></i>
                        <span>Купить</span>
                    </button>
                </div>

                <div class="fast-order">
                    <h3 class="fast-title">Купити в 1 клік</h3>
                    <p class="fast-text">Можна залишивши свій номер телефону. Наш менеджер зв'яжеться з Вами і уточнить деталі замовлення найближчим часом</p>
                    {{ form_start(orderForm, { 'attr': {'id': 'order-form', 'class': 'order-form', 'action': path('oneclick') } }) }}
                    <div class="order-group">
                        {{ form_widget(orderForm.phone_number, { 'attr': {'class': 'form-input'} }) }}
                        {% for errorItem in orderForm.phone_number.vars.errors %}
                            <span class="help-register">{{ errorItem.message }}</span>
                        {% endfor %}
                        <button class="ord-btn" value="Замовити">Замовити</button>
                    </div>
                    <ul id="form-error">
                    </ul>
                    {{ form_widget(orderForm.idProduct, { 'attr': {'value': product.id} }) }}
                    {{ form_widget(orderForm.stock, { 'attr': {'value': product.inStock} }) }}
                    {{ form_widget(orderForm.priceProduct, { 'attr': {'value': product.final_price} }) }}
                    {{ form_end(orderForm) }}
                </div>

                <div class="product-utp">
                    <div class="utp-block">
                        <div class="utp-icon">Оплата</div>
                        <div class="utp-info">
                            <ul>
                                <li>Можлива оплата при отриманні товару</li>
                                <li>Безготівковий розрахунок</li>
                                <li>Оплата на карту</li>
                            </ul>
                        </div>
                    </div>
                    <div class="utp-block">
                        <div class="utp-icon">Доставка</div>
                        <div class="utp-info">
                            <ul>
                                <li>Швидка доставка по всій Україні</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="productInfo">
            <!-- Description -->
            <div class="product_tabs">
                <div class="tab-description">
                    <h3>Опис</h3>
                    <span id="desc">{{ product.description }}</span>
                    <button class="read-next">Читати повністю</button>
                </div>
            </div>

            <!-- Comments -->
            <div class="product-reviews">
                <div class="tab-commnets">
                    <div class="head-comments">
                        <h3>Відгуки про {{ product.name }}</h3>
                        <a class="write-comment popup-link" href="#user-message">Написати відгук</a>
                    </div>
                    {% if commentProduct.comments is empty %}
                        <h3 class="text-comment-empty">Тут поки що немає жодного відгука про {{ product.name }}. </h3>
                    {% else %}
                    {% for comment in commentProduct.comments[:1]%}

                    <ul class="list-comments">
                        <li class="comment">
                            <div class="user-comment">
                                <div class="head-user-comment">
                                    <div class="name-user">{{ comment.nickname}}</div>
                                    {% set mnths = ['','січень','лютий','березень','квітень','травень','червень','липень','серпень','вересень','жовтень','листопад','грудень'] %}
                                    <time>{{comment.publishedDate|date('d ')}}{{mnths[comment.publishedDate|date('n')]}}{{comment.publishedDate|date(' Y H:i:s')}}</time>
                                </div>
                                <div class="review-rating">
                                    {% if comment.rating is null %}
{#                                    {% set i = 1 %}#}
{#                                    {% for i in i..5 %}#}
{#                                        <i style="color: silver" class="fas fa-star"></i>#}
{#                                    {% endfor %}#}
                                    {% elseif comment.rating == 0 %}
                                        {#                                    {% set i = 1 %}#}
                                        {#                                    {% for i in i..5 %}#}
                                        {#                                        <i style="color: silver" class="fas fa-star"></i>#}
                                        {#                                    {% endfor %}#}

                                    {% elseif comment.rating == 5 %}
                                            {% set i = 1 %}
                                            {% for i in i..5 %}
                                                <i class="fas fa-star"></i>
                                            {% endfor %}
                                        {% else %}
                                    {% set i = 1 %}
                                        {% for i in i..comment.rating %}
                                            <i  class="fas fa-star"></i>
                                        {% endfor %}
                                    {% for i in 4..comment.rating %}
                                        <i style="color: silver" class="fas fa-star"></i>
                                    {% endfor %}
                                    {% endif %}
                                </div>
                                <div class="user-comment-body">
                                    <div id="desc-body">
                                    <dd >{{comment.body}}
                                    </dd>
{#                                    <button class="read-next-body">Читати повністю</button>#}
                                      {% if comment.dignity is null %}

                                        {% else %}
                                    <dl class="user-comment-advantages">
                                        <dt class="advantages-label">Переваги:</dt>
                                        <dd ><i style="color: #98d648" class="fa fa-plus" aria-hidden="true"></i> {{comment.dignity}}</dd>
{#                                        <button class="read-next-dignity">Читати повністю</button>#}
                                    </dl>
                                            {% endif %}
                                    {% if comment.shortcomings is null %}

                                    {% else %}
                        <dl class="user-comment-advantages">
                        <dt class="advantages-label">Недоліки:</dt>
                        <dd >
                            <i style="color: red" class="fa fa-minus" aria-hidden="true"></i> {{ comment.shortcomings }}</dd>
{#                            <button class="read-next-shortcomings">Читати повністю</button>#}
                        </dl>
                        {% endif %}
                                </div>
                                    <button class="read-next-body">Читати повністю</button>
                            </div>
                        </li>
                    </ul>

                    {% endfor %}
                    {% for category in product.categories %}
                        <span class="comment-list-link">
                            <a href="{{ path('comments', {name: category.title, link: product.link, id: product.id }) }}">Дивитись всі відгуки → </a>
						</span>
                    {% endfor %}
                    {% endif %}
                </div>
            </div>


            <!-- Info -->
            <div class="tab-specifications">
                <div class="head-specifications">
                    <h3>Характеристики</h3>
                </div>
                <table class="table-specifications">
                    <tbody>
                    {% for data in options %}
                        <tr>
                            <td><span>{{ data.name|trans({}, 'options') }}</span></td>

                            {% if data.attributeValue|length > 1 %}
                                <td><span>
                                {% for variable in data.attributeValue %}
                                    {{ variable.value }},
                                {% endfor %}
                                </span></td>

                            {% else %}

                                {% for variable in data.attributeValue %}
                                    <td><span>{{ variable.value }} </span></td>
                                {% endfor %}

                            {% endif %}
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Products Related -->
        <div class="productRelated">
            <h2 class="product-heading">
                <i class="far fa-star"></i>
                <span>Похожие товары</span>
            </h2>
            <button class="prev-slide">&#10094;</button>
            <button class="next-slide">&#10095;</button>
            <div class="product-slider">
                <div id="slideR-row" class="product">
                    {% for cards_product in product_slider.items %}
                        <div class="card">
                            <div class="product-img">
                                <div class="card-block">
                                    {% if app.session.has('wish') %}
                                        {% if cards_product.id in app.session.get('wish').items|keys %}
                                            {% set card_btn_wish = 'active js-wish' %}
                                        {% else %}
                                            {% set card_btn_wish = 'js-wish-product' %}
                                        {% endif %}
                                    {% else %}
                                        {% set card_btn_wish = 'js-wish-product' %}
                                    {% endif %}

                                    {% if app.session.has('compare') %}
                                        {% if cards_product.id in app.session.get('compare').items|keys %}
                                            {% set card_btn_comp = 'active js-comp' %}
                                        {% else %}
                                            {% set card_btn_comp = 'js-compare-product' %}
                                        {% endif %}
                                    {% else %}
                                        {% set card_btn_comp = 'js-compare-product' %}
                                    {% endif %}
                                    <button class="wish {{ card_btn_wish }}"
                                            data-url="{{ path('wish_add', {id: cards_product.id}) }}">
                                        <i class="fas fa-heart"></i>
                                    </button>
                                    <button class="compare {{ card_btn_comp }}"
                                            data-url="{{ path('compare_add', {id: cards_product.id}) }}">
                                        <i class="fas fa-balance-scale"></i>
                                    </button>
                                </div>
                                {% for category in cards_product.categories %}
                                    <a href="{{ path('product', {name: category.title, link: cards_product.link, id: product.id}) }}">
                                {% endfor %}
                                    <img class="card-img"
                                         src="{{ asset(cards_product.mainImage| assets_image_path | imagine_filter('cart_univers2')) }}"
                                         alt="">
                                </a>
                            </div>

                            <div class="card-body">
                                <div class="card-comment">
                                    {% for category in cards_product.categories %}
                                    <a href="{{ path('product', {name: category.title, link: cards_product.link, id: product.id}) }}">
                                    {% endfor %}
                                        <span>залишити відгук</span>
                                        <i class="far fa-comment"></i>
                                    </a>
                                </div>
                                <h3 class="card-title">
                                    {% for category in cards_product.categories %}
                                        <a href="{{ path('product', {name: category.title, link: cards_product.link, id: product.id}) }}">
                                    {% endfor %}
                                        <strong>{{ cards_product.name }}</strong>
                                    </a>
                                </h3>
                                {% if cards_product.discount is not empty %}
                                    <div class="card-old-price">
                                        <s>{{ cards_product.unitPrice }} ₴</s>
                                    </div>
                                    <div class="card-price-discount">
                                        <span>{{ (cards_product.unitPrice * (100 - cards_product.discount)/100)|round(0, 'floor') }}</span>
                                        <span>₴</span>
                                    </div>
                                {% else %}
                                    <div class="card-price">
                                        <span>{{ cards_product.unitPrice }}</span>
                                        <span>₴</span>
                                    </div>
                                {% endif %}
                                <div class="card-buy">
                                    {% if app.session.has('cart') %}
                                        {% if cards_product.id in app.session.get('cart').products|keys %}
                                            {% set card_btn_cart = 'active js-cart' %}
                                        {% else %}
                                            {% set card_btn_cart = 'js-add-product' %}
                                        {% endif %}
                                    {% else %}
                                        {% set card_btn_cart = 'js-add-product' %}
                                    {% endif %}
                                    <button class="buy-btn {{ card_btn_cart }}"
                                            data-url="{{ path('cart_add', {id: cards_product.id}) }}">
                                        <i class="fas fa-shopping-cart"></i>
                                        <span>Купить</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {#{% include 'products/sub_template/_carousel.html.twig' %}#}

        <div id="image" class="popup">
            <div class="popup-body">
                <div class="popup-content popup-content-image">
                    <a href="#" class="popup-close close-popup">
                        <i class="fas fa-times"></i>
                    </a>
                    <div class="popup-image">
                        <img src="{{ asset(product.mainImage| product_image_path) }}" alt="">
                    </div>

                    {% for popup_gallery in product.images %}
                        <div class="popup-image">
                            <img src="{{ asset(popup_gallery.imageName| product_image_path ) }}">
                        </div>
                    {% endfor %}

                    <a class="popup-prev">&#10094;</a>
                    <a class="popup-next">&#10095;</a>
                </div>
            </div>
        </div>
        <div id="user-message" class="popup pop-scroll">
            {% include 'products/sub_template/_product_comments.html.twig' %}
        </div>

    </div>

{% endblock %}
{% block javascripts %}
    {{ parent() }}
    {{ encore_entry_script_tags('product') }}
{% endblock %}